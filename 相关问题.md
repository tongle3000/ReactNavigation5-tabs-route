####  React-Native


##  问题1、 npx react-native init MyApp --template react-native-template-typescript
    Typescript 装不上的话，报下面的错：
    error An unexpected error occurred: “https://registry.yarnpkg.com/react-native-template-react-native-template-typescript: Not found”

    解决办法：
    yarn remove global react-native-cli    清除之前装的   react-native-cli 再装过就可以了。



##  多环境  react-native-config (第三方库网站: js.coach   ;   选择 react native 搜索: config )
    
    测试环境
    开发环境
    发布环境 连接是的是  真实在线的环境
    
    使用详细教程网址: https://js.coach/package/react-native-config

    * 下面这个link不用执行(因为是针对 react-native 0.6   版本之前的需要安装)
    Link the library: react-native link react-native-config

  - 第一步: 具体终端下面安装:
    ①: yarn add react-native-config
    ②: cd ios
    ③: pod install

    -- 针对安卓的 build.gradle 文件设置:  ( * 这个文件改过后得从新打包)
            Extra step for Android
            You'll also need to manually apply a plugin to your app, from 
        要加下面这句话的路径:  
        android/app/build.gradle:

            // 2nd line, add a new apply:
        加上下面这句话, 放在文件最后一行
        apply from: project(':react-native-config').projectDir.getPath() + "/dotenv.gradle"

  - 第二步: 根目录新建 .env 文件
    API_URL=https://myapi.com (放入前面这句后,去首页打印下看看.)

    -- App.tsx文件
        import Config from 'react-native-config';
        <View>
            <Text>{Config.API_URL}</Text> 
        </View>

    运行后, 页面显示 "https://myapi.com" ,说明配置成功了.


##  绝对路径 babel-plugin-module-resolver
    项目大了的时候,会很多../../../的问题,
    - 安装: yarn add babel-plugin-module-resolver
    - 配置 babel.config.js
        export const plugins = [
            [
                'module-resolver',
                {
                    // 属性是个对象, 里面是一些配置项.
                    root: ['./src'],
                    alias: {
                        // 别名的配置, 是个对象.
                        '@/utils': './src/utils',
                        '@/pages': './src/pages',
                        '@/navigator': './src/navigator',
                        '@/models': './src/models',
                        '@/config': './src/config',
                        '@/components': './src/components',
                        '@/assets': './src/assets'
                    }
                }
            ]
        ];
    重启服务运行

    --  页面使用时,地址前加@
        import Home from '@/pages/Home';(导入连接地址报 typescript 红曲线问题)
        配置typescript的: tsconfig.json 文件  

        "baseUrl": "./",    改为: "baseUrl": "./src",  

        // "paths": {},     
        "baseUrl": "./src",                          
         
        "paths": {          
            "@/utils/*": ["utils/*"],
            "@/pages/*": ["pages/*"],
            "@/navigator/*": ["navigator/*"],
            "@/models/*": ["models/*"],
            "@/config/*": ["config/*"],
            "@/components/*": ["components/*"],
            "@/assets/*": ["assets/*"]
        },            

##  API 文档管理工具
    -- 之前遇到的痛点:
        前后端开发步骤不一致
        接口文档混乱
        难查找

    Yapi  API接口文档管理工具 

    依赖: mongodb 和 nodejs ; 可视化部署 
    
    1、视频安装教程: brew tap mongodb/brew

         brew install mongodb-community@4.2 (视频讲的时候是 4.2 版本, 运行安装很慢.可进下面网站下载安装) 
         http://mongodb.com/
         https://www.mongodb.com/try/download/community (可以进这个网站下载 安装)
    
    2、难下载自己下载包配的环境: (参考教程: https://www.cnblogs.com/quickcodes/p/5390482.html 第 4 5 步)

        终端: open -e .bash_profile (打开这个文件放入下面配置的变量,这电脑放的是下面的路径.)

        # mongodb 环境
        export MONGODB_HOME=/Users/tongle3000/Documents/005software/React/mongodb-macos-x86_64-4.2.8
        export PATH=$PATH:$MONGODB_HOME/bin:$PATH

        终端: mongod -version (安装成功,有版本号.)
        
    3, 启动服务 brew services start mongodb-community
    4, 启动服务 brew services stop mongodb-community

    YApi




    MongoDB提供功能强大的分布式文档数据库的企业版和社区版。
    MongoDB Enterprise是MongoDB Enterprise Advanced订阅的一部分，当您在自己的基础架构上运行MongoDB时，MongoDB Enterprise提供最全面的支持和最佳的SLA。MongoDB Enterprise Advanced还为您提供了全面的操作工具，高级分析和数据可视化，平台集成和认证，以及针对您团队的按需培训。

    -- YApi 使用文档 -> 内网部署
    https://hellosean1025.github.io/yapi/

    环境要求
        nodejs（7.6+)
        mongodb（2.6+）
    
    安装: 方式一. 可视化部署[推荐]
    npm install -g yapi-cli --registry https://registry.npm.taobao.org

    启动 Yapi
    yapi server

    创建好后 (切换到部署路径/Users/tongle3000/bear-yapi)
    -- 进入 Yapi 网站 设置数据
        cd bear-yapi
        node vendors/server/app.js 启动指令启动服务器, 

        初始化管理员账号成功,账号名："admin@admin.com"，密码："ymfe.org"

    创建数据  编辑 -> 返回数据设置 设置 id @string    age @integer(0,100)   -> 保存
             运行 -> 发送
             预览 点击 Mock地址：http://127.0.0.1:3001/mock/11/bear/test   
             打开.可以看到数据:  {"id":"510000199605073204","age":"20"}

    能看到部署的选项:
    部署路径: .../bear-yapi
    其他默认就行
    开始部署 ( 如果部署失败,就改个数据库名 ) 有账号密码.

##  react navigation 安装
    终端:
        yarn add @react-navigation/native
        yarn add react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view

            注释:
            react-native-reanimated 动画库
            eact-native-gesture-handler 跨平台的手势库
            react-native-screens
            react-native-safe-area-context 不是长方形 有刘海 打孔的...组件渲染到安全的区域
            @react-native-community/masked-view 堆栈式 导航器所依赖的库

        npx pod-install ios

    在 index.js 或 APP.js里引入  import 'react-native-gesture-handler';

##  堆栈式导航器. (navigator -> 新建 index.tsx)
    终端:
    - yarn add @react-navigation/stack

    - pages -> 新建 Home.tsx , Detail.tsx

    - navigator -> 新建 index.tsx 
    - 主要是创建  NavigationContainer  createStackNavigator(Stack堆栈)

    - let Stack = createStackNavigator();
    Stack 它是个对象, 里面有 2 个属性. { Navigator, Screen }

    - Stack.Navigator  
        ( screenOptions ={{ headerTitleAlign:'center',headerStyle: { backgroundColor: 'papayawhip' } }} ) // android 顶标题居中显示. 因为它默认是居左的.

    - Stack.Screen
        (它有好多属性 name="" component={} options={{ title:'首页' }} )



  # createStackNavigator<>()是可以节后一个泛型的,
    所以下面申明个type
        type RootStackParmList = {    // 赋值个对象类型, 定义属性的 KEY ,值先赋值为 undefined
            Home: undefined;
            Detail: undefined;
        }

    传入 RootStackParamList
    let Stack = createStackNavigator<RootStackParamList>();

        type 类型别名: 相当于重命名,并给它定义独有的属性, 起到一个约束的作用. 约束泛型的类型.
        如: type Name = string;
            let name: Name = '刘德华';

        再如:
        type User = {
            name: string;
        }

        let user: User = {
            name: 'Tong',
            age: 12,        // 这里会报错,因为上面 type User 没有定义这个属性.
        }

    - createStackNavigator<Record<string, object | undefined>>() // 只能定义对象类型,或者 undefined.
        createStackNavigator 继承 Record ,带 2 个参数, 第一个 string; 第二个 object 或 undefined

##  StackNavigationProp  组件之间的链接导航器
    - navigator -> index.tsx
        StackNavigationProp 其实也是跟 createStackNavigator 一样, 也是个类型别名. 也能接收泛型值 RootStackParamList.

        type RootStackNavigation = StackNavigationProp<RootStackParamList>; 
        然后要把这个导出去.
        export type RootStackNavigation = StackNavigationProp<RootStackParamList>;

        要引入 import { createStackNavigator, StackNavigationProp } from '@react-navigation/stack';

    - pages -> Home.tsx (接收 navigator index.tsx 页面定义的 RootStackNavigation)

        引入 navigator -> index.tsx 页面定义的 RootStackNavigation.

        定义类型别名:IProps
        inteface IProps {
            navigation: RootStackNavigation
        }

        能接收泛型值 ...React.Component<IProps>{
            onPress = ()=>{
                const {navigation} = this.props;
                navigation.navigate('Detail');
            }
            render(){
                // 这样,在这里面就可以定义按钮, 跳转到 详情页 了.
                <Button title="跳转到 详情页" onPress={ this.onPress } />
            }
        }

    - 官方使用教程: https://reactnavigation.org/docs/typescript/#type-checking-screens

##  设置安卓 ios header 跳转动画 拖屏 等等 行为,样式
        <Stack.Navigator
                    headerMode="float"
                    screenOptions={{
                        headerTitleAlign: 'center',
                        headerStyleInterpolator:
                            HeaderStyleInterpolators.forUIKit, // 动画效果改变.
                        cardStyleInterpolator:
                            CardStyleInterpolators.forHorizontalIOS,
                        gestureEnabled: true, // android 可拖动最左边 返回
                        gestureDirection: 'horizontal', // android 水平方向滚动页面
                        headerStyle: {
                            ...Platform.select({
                                android: {
                                    elevation: 0,
                                    borderBottomWidth: StyleSheet.hairlineWidth,
                                },
                                ios: {
                                    backgroundColor: '#eee',
                                },
                            }),
                            // backgroundColor: 'red',
                        },
                        // headerTitleStyle:{color:'#ffffff'}
                    }}
                >
##  Detail 页面接收个 ID   
    - navigator -> index.tsx    改了: Detail: { id: number; }
        type RootStackParamList = {
            Home: undefined;
            Detail: {
                id: number;
            };
        };
    - pages -> Home.tsx         加了: ",{id: 100,}"
        onPress = () => {
            const { navigation } = this.props;
            navigation.navigate('Detail', {
                id: 100,
            });
        };
    - pages -> Detail.tsx 页面



##  function ProfileScreen({ route, navigation }: Props) {
      // ...
    }
    
    class ProfileScreen extends React.Component<Props> {
      render() {
            const { navigation } = this.props;
                const onPress = () => {
                  // @ts-ignore
                  navigation.navigate('Notifications');
            };
        // ...
      }
    }



































##  老项目迁移，如何忽略@typescript-eslint对原来js文件的校验？

    module.exports = {const engine = new CLIEngine({
        useEslintrc: false,
        configFile: '.eslintrc.ts.js'
    })

    const fileConfig = engine.getConfigForFile('.eslintrc.ts.js'); // 抽离ts需要的extends信息

    module.exports = {

    extends: [] ,// only js eslint config
    ,,,,
    // 增加如下专门对ts的校验
    overrides: [
        {
        files: ["*.ts", "*.tsx"],
        plugins: ["@typescript-eslint"],
        parser: "@typescript-eslint/parser",
        rules: fileConfig.rules,
        parserOptions: {
            project: './tsconfig.json',
            ecmaFeatures: {
            jsx: true
            }
        }
        }
    ],

    }
